define("caregg/o2o/0.1.0/views/userInfoMgr/BusinessOrgMgrPanel",["jquery/1.10.1/jquery","underscore/1.6.0/underscore","CarEgg","..\\..\\collections\\userInfoMgr\\BusinessOrgCollection","arale-cookie/1.1.0/index","..\\..\\models\\userInfoMgr\\BusinessOrg","..\\common\\Pagination","..\\..\\templates\\common\\pagination.tpl","..\\..\\templates\\userInfoMgr\\businessOrgsTable.tpl","..\\..\\templates\\userInfoMgr\\businessOrgAddForm.tpl","..\\..\\templates\\userInfoMgr\\businessOrgMgrPanel.tpl"],function(require,exports,module){var $=require("jquery/1.10.1/jquery"),_=require("underscore/1.6.0/underscore"),CarEgg=require("CarEgg"),BusinessOrgCollection=require("../.././collections/userInfoMgr/BusinessOrgCollection"),Pagination=require("../common/Pagination"),Tip=CarEgg.utils.tip,idSep="_",BusinessOrgsTableView=CarEgg.View.extend({el:".table-container",template:_.template(require("../.././templates/userInfoMgr/businessOrgsTable.tpl")),render:function(businessOrgs,pageSize){$(this.el).html(this.template({businessOrgs:businessOrgs,pageSize:pageSize,_:_}))}}),BusinessOrgView=CarEgg.View.extend({el:"#businessOrgForm",popMode:!0,events:{"click a.btn-cancel":"cancelForm","click a.btn-submit":"submitForm"},template:_.template(require("../.././templates/userInfoMgr/businessOrgAddForm.tpl")),initialize:function(){},render:function(businessOrg){$(this.el).html(this.template({businessOrg:businessOrg}))},cancelForm:function(){this.hide(),this.trigger("cancelForm")},submitForm:function(){var dataForm=this.$el.find("form");this.formData=CarEgg.utils.toJSON(decodeURIComponent(dataForm.serialize())),this.hide(),this.trigger("submitForm")}}),MainPanel=CarEgg.View.extend({el:"#businessPanel",template:_.template(require("../.././templates/userInfoMgr/businessOrgMgrPanel.tpl")),events:{"click a[data-action=addBusinessOrg]":"addBusinessOrg","click a[data-action=authBusinessOrg]":"authBusinessOrg","click a[data-action=editBusinessOrg]":"editBusinessOrg","click a[data-action=delBusinessOrg]":"delBusinessOrg","click input[data-action=checkAll]":"checkAll","click input[data-id][type=checkbox]":"checkOne"},initialize:function(){this.BusinessOrgCollection=this.BusinessOrgCollection||new BusinessOrgCollection},render:function(params){var pageOpt={};pageOpt.page=params&&params.page||1,pageOpt.rows=params&&params.rows||5,this.businessOrgsTable||this.loadData(pageOpt)},loadData:function(pageOpt){var that=this;that.BusinessOrgCollection.fetch({success:function(businessOrgs){$(that.el).html(that.template()),that.businessOrgsTable=that.businessOrgsTable||new BusinessOrgsTableView,that.businessOrgsTable.render(businessOrgs.models,that.BusinessOrgCollection.paging.pageSize),that.allCheckbox=that.$("input[data-action=checkAll]"),that.checkedIds="",that.pagination=that.pagination||new Pagination({collection:that.BusinessOrgCollection}),that.pagination.render(),that.listenTo(that.BusinessOrgCollection,"paging",function(){that.checkedIds="",that.businessOrgsTable.render(that.BusinessOrgCollection.models,that.BusinessOrgCollection.paging.pageSize)})},error:function(err){console.log(err)},data:pageOpt})},addBusinessOrg:function(){this.businessOrgForm||(this.businessOrgForm=new BusinessOrgView,this.listenTo(this.businessOrgForm,"submitForm",this.createBusinessOrg)),this.businessOrgForm.render(),this.businessOrgForm.show()},authBusinessOrg:function(){},editBusinessOrg:function(){var ids=this.checkedIds.substr(1).split(idSep);ids.length>1?Tip.open("每次只能修改一条记录！",1e3):""==ids[0]?Tip.open("请选择一条记录修改！",1e3):(this.businessOrgForm||(this.businessOrgForm=new BusinessOrgView,this.listenTo(this.businessOrgForm,"submitForm",this.createBusinessOrg)),this.businessOrgForm.render(this.BusinessOrgCollection.get(ids[0])),this.businessOrgForm.show())},delBusinessOrg:function(){},checkOne:function(event){var checkbox=this.$(event.target||event.srcElement)[0];this.checkedIds=checkbox.checked?this.checkedIds+idSep+this.$(checkbox).data("id"):this.checkedIds.replace(idSep+this.$(checkbox).data("id"),""),console.log(this.checkedIds)},checkAll:function(event){var allCheckbox=this.$(event.target||event.srcElement)[0];_.each(this.allCheckbox,function(checkbox){checkbox.checked=allCheckbox.checked}),this.checkedIds="";var that=this;allCheckbox.checked?_.each(this.$("input[data-id]"),function(checkbox){checkbox.checked=!0,that.checkedIds=that.checkedIds+idSep+$(checkbox).data("id")}):_.each(this.$("input[data-id]"),function(checkbox){checkbox.checked=!1}),console.log(this.checkedIds)},createBusinessOrg:function(){var that=this;this.BusinessOrgCollection.create(this.businessOrgForm.formData,{success:function(model,response){1!=response.state||that.businessOrgForm.formData.serviceOrgSeq?that.pagination.toCurPage():(that.BusinessOrgCollection.paging.total=that.BusinessOrgCollection.paging.total+1,that.pagination.render(),that.pagination.toLastPage(!0))},wait:!0})}});module.exports=MainPanel}),define("caregg/o2o/0.1.0/collections/userInfoMgr/BusinessOrgCollection",["jquery/1.10.1/jquery","underscore/1.6.0/underscore","CarEgg","arale-cookie/1.1.0/index","caregg/o2o/0.1.0/models/userInfoMgr/BusinessOrg"],function(require,exports,module){var CarEgg=(require("jquery/1.10.1/jquery"),require("underscore/1.6.0/underscore"),require("CarEgg")),BusinessOrg=(require("arale-cookie/1.1.0/index"),require("caregg/o2o/0.1.0/models/userInfoMgr/BusinessOrg")),BusinessOrgCollection=CarEgg.Collection.extend({url:CarEgg.constant.ROOT_PATH+"/opr/ServiceOrg",model:BusinessOrg});module.exports=BusinessOrgCollection}),define("caregg/o2o/0.1.0/models/userInfoMgr/BusinessOrg",["jquery/1.10.1/jquery","underscore/1.6.0/underscore","CarEgg"],function(require,exports,module){var CarEgg=(require("jquery/1.10.1/jquery"),require("underscore/1.6.0/underscore"),require("CarEgg")),BusinessOrg=CarEgg.Model.extend({defaults:{chineseName:"",serviceOrgCode:"",careggContactPerson:"",careggTel:"",settleDayTypeSeq:"",serviceOrgLevel:"",upServiceOrgSeq:"",primaryAddr:"",serviceOrgStatus:"",orgTypeSeq:""},idAttribute:"serviceOrgSeq"});module.exports=BusinessOrg}),define("caregg/o2o/0.1.0/views/common/Pagination",["jquery/1.10.1/jquery","underscore/1.6.0/underscore","CarEgg"],function(require,exports,module){var $=require("jquery/1.10.1/jquery"),_=require("underscore/1.6.0/underscore"),CarEgg=require("CarEgg"),Pagination=CarEgg.View.extend({el:".pagination-container",template:_.template(require("caregg/o2o/0.1.0/templates/common/pagination.tpl")),aa:"",events:{"click .ui-paging-next":"toNextPage","click .ui-paging-prev":"toPrevPage","click .ui-paging-first":"toFirstPage","click .ui-paging-last":"toLastPage","click .ui-paging-item":"toPageAt"},render:function(){console.log(this.collection.paging),$(this.el).html(this.template({paging:this.collection.paging,_:_}))},getPageIndex:function(){},toNextPage:function(){var curPage=this.$el.find(".ui-paging-current"),that=this,lastIndex=Math.ceil(that.collection.paging.total/(0==that.collection.paging.pageSize?1:that.collection.paging.pageSize))+"";curPage.text()!=lastIndex&&this.collection.fetch({success:function(){that.collection.trigger("paging"),that.render()},error:function(err){console.log("获取分页数据失败！"),console.log(err)},data:{page:parseInt(curPage.text())+1,rows:that.collection.paging.pageSize}})},toPrevPage:function(){var curPage=this.$el.find(".ui-paging-current"),that=this;"1"!=curPage.text()&&this.collection.fetch({success:function(){that.collection.trigger("paging"),that.render()},error:function(err){console.log("获取分页数据失败！"),console.log(err)},data:{page:parseInt(curPage.text())-1,rows:that.collection.paging.pageSize}})},toFirstPage:function(reload){var curPage=this.$el.find(".ui-paging-current"),that=this;(reload||"1"!=curPage.text())&&this.collection.fetch({success:function(){that.collection.trigger("paging"),that.render()},error:function(err){console.log("获取分页数据失败！"),console.log(err)},data:{page:1,rows:that.collection.paging.pageSize}})},toLastPage:function(reload){var curPage=this.$el.find(".ui-paging-current"),that=this,lastIndex=Math.ceil(that.collection.paging.total/(0==that.collection.paging.pageSize?1:that.collection.paging.pageSize))+"";(reload||curPage.text()!=lastIndex)&&this.collection.fetch({success:function(){that.collection.trigger("paging"),that.render()},error:function(err){console.log("获取分页数据失败！"),console.log(err)},data:{page:lastIndex,rows:that.collection.paging.pageSize}})},toPageAt:function(event){var curPage=$(event.target||event.srcElement);if(!curPage.hasClass("ui-paging-current")){curPage.addClass("ui-paging-current").siblings().removeClass("ui-paging-current");var that=this;this.collection.fetch({success:function(){that.collection.trigger("paging"),that.render()},error:function(err){console.log("获取分页数据失败！"),console.log(err)},data:{page:curPage.text(),rows:that.collection.paging.pageSize}})}},toCurPage:function(){var curPage=this.$el.find(".ui-paging-current"),that=this;this.collection.fetch({success:function(){that.collection.trigger("paging"),that.render()},error:function(err){console.log("获取分页数据失败！"),console.log(err)},data:{page:parseInt(curPage.text()),rows:that.collection.paging.pageSize}})}});module.exports=Pagination}),define("caregg/o2o/0.1.0/templates/common/pagination.tpl",[],'<% paging.pageCount = Math.ceil(paging.total/(paging.pageSize == 0 ? 1: paging.pageSize))  %>\n<div class="ui-paging-info">\n    <div class="dataTables-info">当前在第 <%= paging.pageIndex %> 页 每页 <%= paging.pageSize %> 条 总页数 <%= paging.pageCount %> 页</div>\n</div>\n<% if( paging.pageCount > 1){ %>\n<div class="ui-paging">\n    <a class="ui-paging-first" href="javascript:void(0);">首页</a>\n    <a class="ui-paging-prev"  href="javascript:void(0);">上一页</a>\n\n    <% for(var i = 1; i <= paging.pageCount; i++){ %>\n\n        <% if( paging.pageIndex < 5 && paging.pageCount > 9 ){ %>\n            <% if( i == 7 ){ %>\n                <a class="ui-paging-more-next" href="javascript:void(0);">...</a>\n            <% }else if( i == 8 ){ %>\n                <a class="ui-paging-item" href="javascript:void(0);"><%= paging.pageCount %></a>\n                <% break; %>\n            <% }else{ %>\n                <a class="ui-paging-item <%= paging.pageIndex == i  ? "ui-paging-current": "" %>" href="javascript:void(0);"><%= i  %></a>\n            <% } %>\n        <% } %>\n\n        <% if(  paging.pageCount - paging.pageIndex < 4 && paging.pageCount > 9 ){ %>\n            <% if( i == 1 ){ %>\n                <a class="ui-paging-item" href="javascript:void(0);">1</a>\n            <% }else if( i == 2 ){ %>\n                <a class="ui-paging-more-prev" href="javascript:void(0);">...</a>\n            <% }else if( i > paging.pageCount - 6 ){ %>\n                <a class="ui-paging-item <%= paging.pageIndex == i  ? "ui-paging-current": "" %>" href="javascript:void(0);"><%= i  %></a>\n            <% } %>\n        <% } %>\n\n        <% if(  paging.pageIndex > 4 && paging.pageCount - paging.pageIndex > 3 && paging.pageCount > 9  ){ %>\n            <% if( i == 1 ){ %>\n                <a class="ui-paging-item" href="javascript:void(0);">1</a>\n            <% }else if( i == 2 ){ %>\n                <a class="ui-paging-more-prev" href="javascript:void(0);">...</a>\n            <% }else if( i > paging.pageIndex - 3 && i < paging.pageIndex + 3 ){ %>\n                <a class="ui-paging-item <%= paging.pageIndex == i  ? "ui-paging-current": "" %>" href="javascript:void(0);"><%= i  %></a>\n            <% }else if( i == paging.pageCount - 1  ){ %>\n                <a class="ui-paging-more-next" href="javascript:void(0);">...</a>\n            <% }else if( i == paging.pageCount ){ %>\n                <a class="ui-paging-item" href="javascript:void(0);"><%= paging.pageCount %></a>\n            <% } %>\n        <% } %>\n\n        <% if( paging.pageCount < 10 ){ %>\n            <a class="ui-paging-item <%= paging.pageIndex == i  ? "ui-paging-current": "" %>" href="javascript:void(0);"><%= i  %></a>\n        <% }%>\n\n    <% } %>\n\n    <a class="ui-paging-next" href="javascript:void(0);">下一页</a>\n    <a class="ui-paging-last" href="javascript:void(0);">末页</a>\n</div>\n<% } %>\n'),define("caregg/o2o/0.1.0/templates/userInfoMgr/businessOrgsTable.tpl",[],'<table class="ui-table">\n    <thead>\n    <tr><td><input type="checkbox" data-action="checkAll">全选</td><td>商家名称 </td><td>商家代码</td><td>联系人</td><td>联系电话</td><td>结算周期</td><td>服务类型</td><td>商家级别</td><td>上级组织</td><td>位置区域</td><td>商家状态</td></tr>\n    </thead>\n    <tbody>\n    <% for(var i= 0,m=businessOrgs.length ; i<pageSize; i++){ %>\n    <% if( i < m ){ %>\n    <tr>\n        <td><input type="checkbox" data-id="<%= businessOrgs[i].get("serviceOrgSeq") %>"></td>\n        <td><%= businessOrgs[i].get("chineseName") %></td>\n        <td><%= businessOrgs[i].get("serviceOrgCode") %></td>\n        <td><%= businessOrgs[i].get("careggContactPerson") %></td>\n        <td><%= businessOrgs[i].get("careggTel") %></td>\n        <td><%= businessOrgs[i].get("settleDayTypeSeq") %></td>\n        <td><%= businessOrgs[i].get("orgTypeSeq") %></td>\n        <td><%= businessOrgs[i].get("serviceOrgLevel") %></td>\n        <td><%= businessOrgs[i].get("upServiceOrgSeq") %></td>\n        <td><%= businessOrgs[i].get("primaryAddr") %></td>\n        <td><%= businessOrgs[i].get("serviceOrgStatus") %></td>\n    </tr>\n    <% }%>\n    <% } %>\n    </tbody>\n    <tfoot>\n\n    </tfoot>\n</table>'),define("caregg/o2o/0.1.0/templates/userInfoMgr/businessOrgAddForm.tpl",[],'<% edit = !_.isEmpty(businessOrg) %>\n<div class="caregg-form">\n    <form name="sysRoleForm">\n        <% if(edit){ %>\n        <input type="hidden" name="serviceOrgSeq" value="<%= businessOrg.get("serviceOrgSeq")%>"/>\n        <% } %>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">中文名称:</label><div class="caregg-form-content"><input type="text" name="chineseName" value="<%= edit ? businessOrg.get("chineseName"): ""%>"/></div>\n        </div>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">英文名称:</label><div class="caregg-form-content"><input type="text" name="englishName" value="<%= edit ? businessOrg.get("englishName"): ""%>"/></div>\n        </div>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">商家代码:</label><div class="caregg-form-content"><input type="text" name="serviceOrgCode" value="<%= edit ? businessOrg.get("serviceOrgCode"): "" %>"/></div>\n        </div>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">联系方式:</label><div class="caregg-form-content"><input type="text" name="careggEmail" value="<%= edit ? businessOrg.get("careggEmail"): "" %>"/></div>\n        </div>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">联系人:</label><div class="caregg-form-content"><textarea name="careggContactPerson"><%= edit ? businessOrg.get("careggContactPerson"): "" %></textarea></div>\n        </div>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">联系电话:</label><div class="caregg-form-content"><textarea name="careggTel"><%= edit ? businessOrg.get("careggTel"): "" %></textarea></div>\n        </div>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">结算周期:</label><div class="caregg-form-content"><textarea name="settleDayTypeSeq"><%= edit ? businessOrg.get("settleDayTypeSeq"): "" %></textarea></div>\n        </div>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">商家状态:</label><div class="caregg-form-content"><textarea name="serviceOrgStatus"><%= edit ? businessOrg.get("serviceOrgStatus"): "" %></textarea></div>\n        </div>\n        <div class="caregg-form-group">\n            <label class="caregg-form-label">描述:</label><div class="caregg-form-content"><textarea name="orgDesc"><%= edit ? businessOrg.get("orgDesc"): "" %></textarea></div>\n        </div>\n        <div class="caregg-form-group">\n            <a class="caregg-btn btn-submit">确认</a>  <a class="caregg-btn btn-cancel">取消</a>\n        </div>\n    </form>\n</div>'),define("caregg/o2o/0.1.0/templates/userInfoMgr/businessOrgMgrPanel.tpl",[],'<div class="businessPanelWrap">\n    <div class="tip-container">\n        <span class="fn-left">当前位置：</span>\n        <div class="caregg-breadcrumb fn-left">\n            <ol class="fn-clearfix">\n                <li><a href="">配置</a></li>\n                <li><a href="">系统设置</a></li>\n                <li class="active" ><a href="">商家组织管理</a></li>\n            </ol>\n        </div>\n    </div>\n    <div class="caregg-tab-v8" id="main-child-tab">\n        <div class="tool-bar fn-clearfix">\n            <a class="caregg-btn" data-action="addBusinessOrg" title="新增" href="javascript:void(0);">新增</a>\n            <a class="caregg-btn" data-action="authBusinessOrg" title="授权" href="javascript:void(0);">授权</a>\n            <a class="caregg-btn" data-action="editBusinessOrg" title="修改" href="javascript:void(0);">修改</a>\n            <a class="caregg-btn" data-action="delBusinessOrg" title="删除" href="javascript:void(0);">删除</a>\n        </div>\n\n        <div class="" id="businessOrgForm">\n        </div>\n        <div class="table-container">\n        </div>\n        <div class="pagination-container">\n        </div>\n\n    </div>\n</div>');